# å¿«é€Ÿå…¥é—¨

<cite>
**æœ¬æ–‡æ¡£ä¸­å¼•ç”¨çš„æ–‡ä»¶**
- [QUICK_START.md](file://QUICK_START.md)
- [README.md](file://README.md)
- [mlx-grpo.py](file://mlx-grpo.py)
- [configs/smoke_test.toml](file://configs/smoke_test.toml)
- [configs/prod.toml](file://configs/prod.toml)
- [utils/README.md](file://utils/README.md)
- [pyproject.toml](file://pyproject.toml)
</cite>

## ç›®å½•
1. [ç®€ä»‹](#ç®€ä»‹)
2. [ç³»ç»Ÿè¦æ±‚](#ç³»ç»Ÿè¦æ±‚)
3. [å®‰è£…æ­¥éª¤](#å®‰è£…æ­¥éª¤)
4. [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
5. [é…ç½®æ–‡ä»¶è¯¦è§£](#é…ç½®æ–‡ä»¶è¯¦è§£)
6. [å‘½ä»¤è¡Œå‚æ•°è¯¦è§£](#å‘½ä»¤è¡Œå‚æ•°è¯¦è§£)
7. [å…¸åž‹ä½¿ç”¨åœºæ™¯](#å…¸åž‹ä½¿ç”¨åœºæ™¯)
8. [çŽ¯å¢ƒå˜é‡é…ç½®](#çŽ¯å¢ƒå˜é‡é…ç½®)
9. [å‚æ•°æ‰«æä¸Žä¼˜åŒ–](#å‚æ•°æ‰«æä¸Žä¼˜åŒ–)
10. [æ•…éšœæŽ’é™¤](#æ•…éšœæŽ’é™¤)
11. [ä¸‹ä¸€æ­¥](#ä¸‹ä¸€æ­¥)

## ç®€ä»‹

MLX-GRPOæ˜¯ä¸€ä¸ªåŸºäºŽApple Siliconçš„çº¯MLXæ¡†æž¶å¤§åž‹è¯­è¨€æ¨¡åž‹è®­ç»ƒæ¡†æž¶ï¼Œä¸“é—¨å®žçŽ°Group-based Relative Policy Optimization (GRPO)ç®—æ³•ã€‚æœ¬å¿«é€Ÿå…¥é—¨æŒ‡å—æ—¨åœ¨è®©æ‚¨åœ¨2åˆ†é’Ÿå†…å¯åŠ¨é¦–æ¬¡è®­ç»ƒï¼Œæ— éœ€å¤æ‚çš„é…ç½®è¿‡ç¨‹ã€‚

### æ ¸å¿ƒç‰¹æ€§
- **çº¯MLXé›†æˆ**ï¼šä»…åœ¨Apple Siliconä¸Šè¿è¡Œï¼Œåˆ©ç”¨MetalåŽç«¯
- **GRPOè®­ç»ƒç®¡é“**ï¼šå®žçŽ°å¤šç§å¥–åŠ±å‡½æ•°ä¼˜åŒ–é“¾å¼æ€ç»´å“åº”
- **é€šç”¨æ¨¡åž‹æ”¯æŒ**ï¼šå†…ç½®è½¬æ¢å·¥å…·æ”¯æŒä»»æ„Hugging Faceæ¨¡åž‹
- **æ•°æ®é›†é¢„å¤„ç†**ï¼šä½¿ç”¨GSM8Kæ•°æ®é›†æµ‹è¯•å¤šæ­¥æŽ¨ç†èƒ½åŠ›

## ç³»ç»Ÿè¦æ±‚

### ç¡¬ä»¶è¦æ±‚
- **Apple Silicon Mac**ï¼ˆM1/M2/M3/M4ç³»åˆ—ï¼‰
- è‡³å°‘ **8GB RAM**ï¼ˆæŽ¨è16GBä»¥ä¸Šï¼‰
- è¶³å¤Ÿçš„å­˜å‚¨ç©ºé—´ï¼ˆæ¨¡åž‹æ–‡ä»¶å¤§å°ä»Žå‡ åMBåˆ°å‡ åGBä¸ç­‰ï¼‰

### è½¯ä»¶è¦æ±‚
- **Python 3.11+**ï¼ˆæŽ¨èæœ€æ–°ç‰ˆæœ¬ï¼‰
- **macOS 14+**ï¼ˆæŽ¨èæœ€æ–°ç‰ˆæœ¬ï¼‰
- **uv CLI**ï¼ˆé¡¹ç›®ç®¡ç†å·¥å…·ï¼‰

## å®‰è£…æ­¥éª¤

### 1. å…‹éš†ä»“åº“

```bash
git clone https://github.com/Doriandarko/MLX-GRPO.git
cd MLX-GRPO
```

### 2. åˆ›å»ºè™šæ‹ŸçŽ¯å¢ƒ

```bash
python3 -m venv venv
source venv/bin/activate
```

### 3. å®‰è£…uvåŒ…ç®¡ç†å™¨

```bash
pip install uv
```

### 4. å®‰è£…ä¾èµ–

```bash
uv sync
```

è¿™å°†è‡ªåŠ¨å®‰è£…æ‰€æœ‰å¿…è¦çš„ä¾èµ–é¡¹ï¼ŒåŒ…æ‹¬MLXã€MLX-LMã€æ•°æ®é›†å¤„ç†åº“ç­‰ã€‚

## å¿«é€Ÿå¼€å§‹

### ç¬¬ä¸€æ­¥ï¼šé€‰æ‹©é…ç½®æ–‡ä»¶

ç³»ç»Ÿæä¾›äº†ä¸‰ä¸ªé¢„é…ç½®çš„è®­ç»ƒè®¾ç½®ï¼š

| é…ç½®æ–‡ä»¶ | ä½¿ç”¨åœºæ™¯ | è®­ç»ƒé€Ÿåº¦ | è´¨é‡ç­‰çº§ | æŽ¨èç”¨é€” |
|----------|----------|----------|----------|----------|
| `smoke_test.toml` | å¿«é€Ÿæµ‹è¯•ä¸Žè°ƒè¯• | ðŸš€ æœ€å¿« | åŸºç¡€ | éªŒè¯å®‰è£… |
| `prod.toml` | ç”Ÿäº§çº§è®­ç»ƒ | ðŸŒ æ…¢ | æœ€ä½³ | æ­£å¼è®­ç»ƒ |
| `medium.toml` | å¹³è¡¡å®žéªŒ | âš¡ ä¸­ç­‰ | è‰¯å¥½ | åˆæ­¥å®žéªŒ |

### ç¬¬äºŒæ­¥ï¼šè¿è¡Œé¦–æ¬¡è®­ç»ƒ

#### å¿«é€Ÿæµ‹è¯•ï¼ˆæŽ¨èï¼‰
```bash
# ä½¿ç”¨çƒŸé›¾æµ‹è¯•é…ç½®è¿›è¡Œå¿«é€ŸéªŒè¯
uv run mlx-grpo.py --config configs/smoke_test.toml
```

#### ç”Ÿäº§çº§è®­ç»ƒ
```bash
# ä½¿ç”¨ç”Ÿäº§é…ç½®è¿›è¡Œå®Œæ•´è®­ç»ƒ
uv run mlx-grpo.py --config configs/prod.toml
```

#### è‡ªå®šä¹‰é…ç½®
```bash
# ä½¿ç”¨é»˜è®¤é…ç½®å¹¶è‡ªå®šä¹‰å‚æ•°
uv run mlx-grpo.py --config configs/prod.toml \
  --set learning_rate=5e-7 \
  --set num_generations=32 \
  --set output_dir="outputs/custom-experiment"
```

**æ®µè½æ¥æº**
- [QUICK_START.md](file://QUICK_START.md#L1-L75)
- [README.md](file://README.md#L18-L86)

## é…ç½®æ–‡ä»¶è¯¦è§£

### smoke_test.toml - å¿«é€Ÿæµ‹è¯•é…ç½®

è¿™æ˜¯æœ€å¿«çš„é…ç½®é€‰é¡¹ï¼Œé€‚åˆéªŒè¯ç³»ç»Ÿæ˜¯å¦æ­£å¸¸å·¥ä½œï¼š

```toml
# æœ€å°åŒ–è®¾ç½®ç”¨äºŽå¿«é€Ÿæµ‹è¯•
model_name = "utils/mlx_model"    # â† å·²è½¬æ¢çš„é‡åŒ–æ¨¡åž‹
output_dir = "outputs/smoke-test"
run_name   = "smoke-test-run"

# æžç®€è®­ç»ƒè®¾ç½®
learning_rate = 1e-6
num_generations = 2                # åªç”Ÿæˆ2ä¸ªæ ·æœ¬
max_new_tokens = 32                # çŸ­åºåˆ—
max_train_samples = 50             # ä»…ä½¿ç”¨50ä¸ªæ ·æœ¬
eval_steps = 5                     # é¢‘ç¹è¯„ä¼°
```

### prod.toml - ç”Ÿäº§çº§é…ç½®

å®Œæ•´çš„DeepSeeké£Žæ ¼é…ç½®ï¼Œé€‚åˆå®žé™…è®­ç»ƒï¼š

```toml
# ç”Ÿäº§è´¨é‡è®¾ç½®
model_name = "utils/mlx_model"
output_dir = "outputs/production-run"
run_name   = "qwen-1.5b-production"

# æ ‡å‡†è®­ç»ƒå‚æ•°
learning_rate = 1e-6
num_generations = 16               # 16ä¸ªæ ·æœ¬èŽ·å¾—è‰¯å¥½ä¼˜åŠ¿ä¼°è®¡
max_new_tokens = 256               # è¾ƒé•¿å®Œæˆä»¥èŽ·å¾—å®Œæ•´æŽ¨ç†
max_train_samples = 2000           # è®­ç»ƒ2000ä¸ªæ ·æœ¬
```

### é…ç½®æ–‡ä»¶ç»“æž„

æ¯ä¸ªé…ç½®æ–‡ä»¶éƒ½åŒ…å«ä»¥ä¸‹æ ¸å¿ƒéƒ¨åˆ†ï¼š

```toml
# æ¨¡åž‹é…ç½®
model_name = "Qwen/Qwen2.5-1.5B-Instruct"
output_dir = "outputs/my_run"
run_name   = "my-experiment"

# è®­ç»ƒå‚æ•°
learning_rate = 1e-6
num_generations = 8
max_new_tokens = 128
temperature = 0.7

# ç³»ç»Ÿè®¾ç½®
seed = 0
use_compile = true
```

**æ®µè½æ¥æº**
- [configs/smoke_test.toml](file://configs/smoke_test.toml#L1-L38)
- [configs/prod.toml](file://configs/prod.toml#L1-L40)

## å‘½ä»¤è¡Œå‚æ•°è¯¦è§£

### åŸºæœ¬è¯­æ³•

```bash
uv run mlx-grpo.py [OPTIONS]
```

### ä¸»è¦å‚æ•°

#### --config
æŒ‡å®šé…ç½®æ–‡ä»¶è·¯å¾„ï¼š
```bash
# ä½¿ç”¨ç‰¹å®šé…ç½®
uv run mlx-grpo.py --config configs/smoke_test.toml

# ä½¿ç”¨è‡ªå®šä¹‰é…ç½®
uv run mlx-grpo.py --config my_config.toml
```

#### --set
åŠ¨æ€è¦†ç›–é…ç½®å‚æ•°ï¼ˆæ— éœ€ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼‰ï¼š

```bash
# ä¿®æ”¹å­¦ä¹ çŽ‡
uv run mlx-grpo.py --config configs/prod.toml --set learning_rate=5e-7

# å¢žåŠ ç”Ÿæˆæ•°é‡
uv run mlx-grpo.py --config configs/prod.toml --set num_generations=64

# å¤šä¸ªå‚æ•°åŒæ—¶è®¾ç½®
uv run mlx-grpo.py --config configs/prod.toml \
  --set num_generations=32 \
  --set max_new_tokens=256 \
  --set temperature=0.8
```

### å‚æ•°ç±»åž‹è½¬æ¢

ç³»ç»Ÿä¼šè‡ªåŠ¨å¤„ç†ä¸åŒç±»åž‹çš„å‚æ•°ï¼š

```bash
# æ•°å€¼ç±»åž‹ï¼ˆè‡ªåŠ¨è½¬æ¢ï¼‰
--set learning_rate=5e-7      # float
--set num_generations=32      # int
--set use_compile=true        # bool

# å­—ç¬¦ä¸²ç±»åž‹ï¼ˆä¿æŒåŽŸæ ·ï¼‰
--set model_name="Qwen-1.5B"
--set output_dir="custom-path"
```

**æ®µè½æ¥æº**
- [mlx-grpo.py](file://mlx-grpo.py#L1140-L1175)
- [mlx-grpo.py](file://mlx-grpo.py#L380-L409)

## å…¸åž‹ä½¿ç”¨åœºæ™¯

### åœºæ™¯1ï¼šå°è¯•ä¸åŒæ¨¡åž‹

```bash
# ä½¿ç”¨Qwen 3Bæ¨¡åž‹è¿›è¡Œå®žéªŒ
uv run mlx-grpo.py --config configs/prod.toml \
  --set model_name="mlx-community/Qwen2.5-3B-Instruct-4bit" \
  --set output_dir="outputs/Qwen-3B-test"
```

### åœºæ™¯2ï¼šå¿«é€Ÿè°ƒè¯•è¿è¡Œ

```bash
# æœ€å°åŒ–è®¾ç½®è¿›è¡Œå¿«é€Ÿè¿­ä»£
uv run mlx-grpo.py --config configs/smoke_test.toml
```

### åœºæ™¯3ï¼šå®Œæ•´è®­ç»ƒè¿è¡Œ

```bash
# ä½¿ç”¨æ‰€æœ‰DeepSeekå‚æ•°è¿›è¡Œå®Œæ•´è®­ç»ƒ
uv run mlx-grpo.py --config configs/prod.toml
```

### åœºæ™¯4ï¼šåˆ›å»ºè‡ªå®šä¹‰é…ç½®

```bash
# å¤åˆ¶å¹¶ç¼–è¾‘é…ç½®æ–‡ä»¶
cp configs/prod.toml configs/my_experiment.toml
# ç¼–è¾‘ configs/my_experiment.toml è®¾ç½®
uv run mlx-grpo.py --config configs/my_experiment.toml
```

### åœºæ™¯5ï¼šå¯é‡çŽ°æ€§å®žéªŒ

```bash
# è®¾ç½®ç‰¹å®šç§å­
uv run mlx-grpo.py --config configs/prod.toml --set seed=42

# ä¸Žå›¢é˜Ÿå…±äº«é…ç½®æ–‡ä»¶
git add configs/my_experiment.toml
git commit -m "æ·»åŠ å®žéªŒé…ç½®"
```

**æ®µè½æ¥æº**
- [QUICK_START.md](file://QUICK_START.md#L76-L159)

## çŽ¯å¢ƒå˜é‡é…ç½®

### MLX_GRPO_CONFIG çŽ¯å¢ƒå˜é‡

è®¾ç½®é»˜è®¤é…ç½®æ–‡ä»¶è·¯å¾„ï¼Œé¿å…æ¯æ¬¡è¾“å…¥å®Œæ•´è·¯å¾„ï¼š

```bash
# ä¸€æ¬¡æ€§è®¾ç½®
export MLX_GRPO_CONFIG=configs/my_experiment.toml

# ç„¶åŽå¯ä»¥è¿™æ ·è¿è¡Œ
uv run mlx-grpo.py
uv run mlx-grpo.py --set seed=42
uv run mlx-grpo.py --set learning_rate=5e-7
```

### çŽ¯å¢ƒå˜é‡ä¼˜å…ˆçº§

å‘½ä»¤è¡Œå‚æ•°å…·æœ‰æœ€é«˜ä¼˜å…ˆçº§ï¼Œå…¶æ¬¡æ˜¯çŽ¯å¢ƒå˜é‡ï¼Œæœ€åŽæ˜¯é…ç½®æ–‡ä»¶ï¼š

```bash
# ä¼˜å…ˆçº§ï¼šå‘½ä»¤è¡Œ > çŽ¯å¢ƒå˜é‡ > é»˜è®¤å€¼
export MLX_GRPO_CONFIG=configs/default.toml
uv run mlx-grpo.py --config configs/smoke_test.toml  # ä½¿ç”¨ smoke_test.toml
```

**æ®µè½æ¥æº**
- [mlx-grpo.py](file://mlx-grpo.py#L1140-L1175)

## å‚æ•°æ‰«æä¸Žä¼˜åŒ–

### å­¦ä¹ çŽ‡æ‰«æ

```bash
# å°è¯•å¤šä¸ªå­¦ä¹ çŽ‡
for lr in 1e-6 5e-7 1e-7; do
    uv run mlx-grpo.py --config configs/prod.toml \
        --set learning_rate=$lr \
        --set output_dir="outputs/lr_${lr}"
done
```

### å‚æ•°ç»„åˆæ‰«æ

```bash
# æ‰¹é‡æµ‹è¯•ä¸åŒå‚æ•°ç»„åˆ
for gen in 8 16 32; do
    for temp in 0.7 0.8 0.9; do
        uv run mlx-grpo.py --config configs/prod.toml \
            --set num_generations=$gen \
            --set temperature=$temp \
            --set output_dir="outputs/gen${gen}_temp${temp}"
    done
done
```

### æˆåŠŸé…ç½®ä¿å­˜

æ‰¾åˆ°å¥½çš„å‚æ•°è®¾ç½®åŽï¼Œä¿å­˜åˆ°é…ç½®æ–‡ä»¶ï¼š

```bash
# å‘çŽ°å¥½çš„è®¾ç½®ï¼Ÿä¿å­˜å®ƒä»¬ï¼
cat > configs/successful_run.toml << EOF
learning_rate = 5e-7
num_generations = 32
temperature = 0.8
seed = 42
EOF
```

**æ®µè½æ¥æº**
- [QUICK_START.md](file://QUICK_START.md#L160-L204)

## æ•…éšœæŽ’é™¤

### å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

#### âŒ é…ç½®æ–‡ä»¶æœªæ‰¾åˆ°
**é—®é¢˜**ï¼š`Config file not found`
**è§£å†³æ–¹æ¡ˆ**ï¼šæ£€æŸ¥è·¯å¾„ï¼Œä½¿ç”¨ç»å¯¹è·¯å¾„æˆ–ç¡®ä¿åœ¨æ­£ç¡®ç›®å½•ä¸‹
```bash
uv run mlx-grpo.py --config /full/path/to/configs/default.toml
```

#### âŒ æœªçŸ¥é…ç½®é”®
**é—®é¢˜**ï¼š`Unknown config key`
**è§£å†³æ–¹æ¡ˆ**ï¼šæ£€æŸ¥æ‹¼å†™ï¼Œå‚è€ƒé…ç½®æŒ‡å—ç¡®è®¤æœ‰æ•ˆé”®å

#### âŒ å€¼ç±»åž‹è½¬æ¢å¤±è´¥
**é—®é¢˜**ï¼š`Failed to coerce value`
**è§£å†³æ–¹æ¡ˆ**ï¼šæ£€æŸ¥å€¼ç±»åž‹ï¼ŒCLIä¸­æ•°å­—ä¸åº”åŠ å¼•å·
```bash
# âœ… æ­£ç¡®
--set num_generations=32

# âŒ é”™è¯¯ï¼ˆä¼šå¯¼è‡´é—®é¢˜ï¼‰
--set num_generations="32"
```

#### âŒ å†…å­˜ä¸è¶³
**è§£å†³æ–¹æ¡ˆ**ï¼š
- ä½¿ç”¨æ›´æ¿€è¿›çš„é‡åŒ–ï¼ˆ`--bits 2`ï¼‰
- å‡å°‘`num_generations`å’Œ`max_new_tokens`
- å¢žåŠ ç³»ç»Ÿå†…å­˜é™åˆ¶

### è°ƒè¯•æŠ€å·§

```bash
# å¯ç”¨è¯¦ç»†è¾“å‡º
uv run mlx-grpo.py --config configs/smoke_test.toml --set use_compile=false

# æ£€æŸ¥é…ç½®åŠ è½½
uv run mlx-grpo.py --config configs/smoke_test.toml --set verbose=true

# æµ‹è¯•æ¨¡åž‹åŠ è½½
uv run mlx-grpo.py --config configs/smoke_test.toml --set max_train_samples=1
```

**æ®µè½æ¥æº**
- [QUICK_START.md](file://QUICK_START.md#L160-L204)

## ä¸‹ä¸€æ­¥

### 1. è¿è¡Œæ‚¨çš„é¦–æ¬¡è®­ç»ƒ
```bash
# ä½¿ç”¨çƒŸé›¾æµ‹è¯•é…ç½®éªŒè¯ä¸€åˆ‡æ­£å¸¸
uv run mlx-grpo.py --config configs/smoke_test.toml
```

### 2. å°è¯•ä¸åŒçš„è®¾ç½®
```bash
# ä½¿ç”¨--setå‚æ•°è¦†ç›–é…ç½®
uv run mlx-grpo.py --config configs/smoke_test.toml --set num_generations=16
```

### 3. åˆ›å»ºæ‚¨è‡ªå·±çš„é…ç½®æ–‡ä»¶
```bash
# å¤åˆ¶å¹¶ç¼–è¾‘é…ç½®
cp configs/prod.toml configs/my_experiment.toml
vim configs/my_experiment.toml  # ç¼–è¾‘è®¾ç½®
```

### 4. æŽ¢ç´¢é«˜çº§åŠŸèƒ½
- é˜…è¯»å®Œæ•´çš„é…ç½®æŒ‡å—
- å°è¯•ä¸åŒçš„æ¨¡åž‹è½¬æ¢
- å®žéªŒå„ç§å¥–åŠ±å‡½æ•°

### 5. èŽ·å–æ›´å¤šå¸®åŠ©
- ðŸ“– å®Œæ•´æ–‡æ¡£ï¼š[CONFIG_GUIDE.md](CONFIG_GUIDE.md)
- ðŸ“‹ æ›´æ–°æ—¥å¿—ï¼š[CHANGELOG.md](CHANGELOG.md)
- ðŸ”„ è¿ç§»è¯´æ˜Žï¼š[.config-migration-notes.md](.config-migration-notes.md)
- ðŸ“Š å®žçŽ°ç»†èŠ‚ï¼š[IMPLEMENTATION_SUMMARY.md](IMPLEMENTATION_SUMMARY.md)

**æ®µè½æ¥æº**
- [QUICK_START.md](file://QUICK_START.md#L205-L245)

## ç¤ºä¾‹ä¼šè¯

ä»¥ä¸‹æ˜¯å…¸åž‹çš„ç»ˆç«¯ä¼šè¯å±•ç¤ºä½¿ç”¨æµç¨‹ï¼š

```bash
# ç»ˆç«¯ä¼šè¯æ˜¾ç¤ºå…¸åž‹ç”¨æ³•

$ cd MLX-GRPO

# å¿«é€Ÿæµ‹è¯•
$ uv run mlx-grpo.py --config configs/smoke_test.toml
[config] loading configs/smoke_test.toml
================================================================================
MLX-GRPO Training Pipeline
================================================================================
Model: Qwen/Qwen2.5-1.5B-Instruct
Output Dir: outputs/smoke-test
...

# é‚£ä¸ªå·¥ä½œäº†ï¼å°è¯•æ›´å¤šç”Ÿæˆ
$ uv run mlx-grpo.py --config configs/smoke_test.toml --set num_generations=16
[config] loading configs/smoke_test.toml
[config] applying overrides: ['num_generations=16']
...

# åˆ›å»ºè‡ªå®šä¹‰é…ç½®
$ cp configs/prod.toml configs/my_run.toml
$ vim configs/my_run.toml  # ç¼–è¾‘è®¾ç½®

# ä½¿ç”¨è‡ªå®šä¹‰é…ç½®è¿è¡Œ
$ uv run mlx-grpo.py --config configs/my_run.toml
...

# æˆåŠŸï¼ðŸŽ‰
```

**æ®µè½æ¥æº**
- [QUICK_START.md](file://QUICK_START.md#L205-L245)